<div class="container" dir="rtl">
  <header class="header">
    <h1>ุชุดุฎุต ูุงููุฌุงุฑโูุง ุฑู</h1>
    <p class="subtitle">ุณุณุชู ููุด ูุตููุน ูุงุจู ุชูุณุฑ ุจุฑุง ุชุตุงูุฑ ุณโุช ุงุณฺฉู ู ุงฺฉุณโุฑ ููุณู ุณูู</p>
  </header>

  <main class="main-content">
    
    <!-- Upload Section -->
    <div class="card upload-card" *ngIf="!prediction" @fadeIn>
      <div class="upload-area" (click)="fileInput.click()" [class.has-image]="imagePreview">
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
        
        <div *ngIf="!imagePreview" class="upload-placeholder">
          <div class="icon">โ๏ธ</div>
          <h3>ุจุฑุง ุขูพููุฏ ุชุตูุฑ ุณโุช ุงุณฺฉู ุง ุงฺฉุณโุฑ ฺฉูฺฉ ฺฉูุฏ</h3>
          <p>ูุฑูุชโูุง ูพุดุชุจุงู ุดุฏู: JPG, PNG, JPEG</p>
        </div>

        <img *ngIf="imagePreview" [src]="imagePreview" class="preview-image" alt="ูพุดโููุงุด">
      </div>

      <div class="actions" *ngIf="selectedFile">
        <button class="btn btn-primary" (click)="uploadAndPredict()" [disabled]="loading">
          <span *ngIf="!loading">ุชุญูู ุชุตูุฑ โจ</span>
          <span *ngIf="loading" class="loader"></span>
        </button>
      </div>
      
      <div class="error" *ngIf="error">{{ error }}</div>
    </div>

    <!-- Results Section -->
    <div class="results-container" *ngIf="prediction" @fadeIn>
      <button class="btn btn-secondary back-btn" (click)="reset()">โ ุชุญูู ุชุตูุฑ ุฌุฏุฏ</button>

      <div class="result-card">
        <div class="image-comparison">
          <div class="img-box">
            <h4>ุชุตูุฑ ุงุตู</h4>
            <img [src]="'data:image/png;base64,' + prediction.original_image_base64" alt="ุงุตู">
          </div>
          <div class="img-box heatmap">
            <h4>ุชูุฌู ููุด ูุตููุน (Grad-CAM)</h4>
            <img [src]="'data:image/png;base64,' + prediction.heatmap_base64" alt="ููุดู ุญุฑุงุฑุช">
          </div>
        </div>

        <div class="diagnosis-info" [class.danger]="prediction.prediction_class !== 'Normal'" [class.success]="prediction.prediction_class === 'Normal'">
          <h2>ุชุดุฎุต: {{ getPersianLabel(prediction.prediction_class) }}</h2>
          <div class="confidence-bar">
            <span>ุงุทููุงู: {{ (prediction.confidence * 100) | number:'1.1-2' }}%</span>
            <div class="progress">
              <div class="progress-fill" [style.width]="(prediction.confidence * 100) + '%'"></div>
            </div>
          </div>
          <p class="explanation">
            ููุด ูุตููุน ููุงุทู ูุดฺฉูฺฉ ุฑุง ุฏุฑ ููุดู ุญุฑุงุฑุช ูุดุฎุต ฺฉุฑุฏู ุงุณุช.
            <span *ngIf="prediction.prediction_class !== 'Normal'">ูุทูุงู ุจุฑุง ุชุงุฏ ููุง ุจุง ุฑุงุฏูููฺุณุช ูุดูุฑุช ฺฉูุฏ.</span>
          </p>
        </div>
      </div>
    </div>


    <!-- Dataset Section -->
    <div class="card dataset-card" *ngIf="!prediction" @fadeIn>
      <h2>ุจุงุฑฺฏุฐุงุฑ ุฏุชุงุณุช ุงุฒ Kaggle</h2>
      <div class="dataset-input-group">
        <input type="text" [(ngModel)]="datasetHandle" placeholder="ูุซุงู: luisblanche/covidct" class="dataset-input">
        <div class="btn-group">
          <button class="btn btn-primary" (click)="loadDataset()" [disabled]="datasetLoading">
            <span *ngIf="!datasetLoading">ุจุงุฑฺฏุฐุงุฑ ุฏุชุงุณุช (API) ๐ฅ</span>
            <span *ngIf="datasetLoading" class="loader"></span>
          </button>
          <button class="btn btn-secondary" (click)="loadMockDataset()" [disabled]="datasetLoading">
            <span>ุจุงุฑฺฏุฐุงุฑ ููููู (Mock) ๐งช</span>
          </button>
        </div>
      </div>

      <div class="error" *ngIf="datasetError">{{ datasetError }}</div>

      <div class="dataset-preview" *ngIf="datasetPreview">
        <h3>ูพุดโููุงุด ุฏุชุงุณุช</h3>
        <p>ุชุนุฏุงุฏ ุณุทุฑ ู ุณุชูู: {{ datasetPreview.shape }}</p>
        
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th *ngFor="let col of datasetPreview.columns">{{ col }}</th>
                <th>ุนููุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of paginatedRows">
                <td *ngFor="let col of datasetPreview.columns">{{ row[col] }}</td>
                <td>
                  <button *ngIf="row['Type'] === '.png' || row['Type'] === '.jpg' || row['Type'] === '.jpeg'" 
                          class="btn btn-sm btn-outline" 
                          (click)="analyzeDatasetImage(row['Path'])">
                    ุชุญูู โก
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination Controls -->
        <div class="pagination-controls" *ngIf="totalPages > 1">
          <button class="btn btn-sm btn-secondary" 
                  (click)="changePage(currentPage - 1)" 
                  [disabled]="currentPage === 1">
            ูุจู
          </button>
          
          <span class="page-info">
            ุตูุญู {{ currentPage }} ุงุฒ {{ totalPages }}
          </span>
          
          <button class="btn btn-sm btn-secondary" 
                  (click)="changePage(currentPage + 1)" 
                  [disabled]="currentPage === totalPages">
            ุจุนุฏ
          </button>
        </div>
      </div>
    </div>

  </main>

</div>
